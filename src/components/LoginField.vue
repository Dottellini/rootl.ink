<template>
  <div class="container">
    <h1>{{$t('login')}}</h1>
    <form class="form">
      <input type="username" v-model="username" placeholder="Username" required>
      <input type="password" v-model="password" placeholder="Password" required>
      <button type="button" @click="submit">{{$t('login')}}</button>
    </form>
    <p class="error">{{error}}</p>

    <h3>{{$t('or')}}</h3>

    <img src="https://images-na.ssl-images-amazon.com/images/G/01/lwa/btnLWA_gry_312x64.png" @click="amazonLogin">

  </div>
</template>

<script>
import GoogleLogin from "./GoogleLogin";
export default {
  name: "LoginField",
  components: {
    GoogleLogin
  },
  data() {
    return {
      username: "",
      password: "",
      error: ""
    }
  },

  mounted() {
    if(this.$store.state.isLoggedIn) {
      this.$router.push({name: "Home"})
    }
  },

  methods: {
    amazonLogin(){
      let store = this.$store
      let router = this.$router

      null!=window.amazon&&null!=window.amazon.Login||function(){var t,e,n,o,r,i,a;function s(t,e){null==t&&(t={});for(var n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var r in o)t[r]=o[r]}return t}function c(t,e){var n=u.apply(void 0,arguments);throw p("error",n),Error(n)}function u(t,e){var n=arguments,o=1;return t.replace(/%((%)|[sid])/g,function(t){return t[2]?t[2]:("object"==typeof(t=n[o++])&&window.JSON&&window.JSON.stringify&&(t=window.JSON.stringify(t)),t)})}function p(t,e){window.console&&window.console.log&&("function"==typeof e&&(e=e()),e=u("[Amazon.%s] %s",t,e),window.console.log(e))}function f(t,e,n){null==e&&c("missing %s",t),typeof e!=n&&c("expected %s to be a %s",t,n)}function d(t){var e=document.getElementById(t);return e||((e=document.createElement("div")).setAttribute("id",t),e.setAttribute("width",0),e.setAttribute("height",0),e.setAttribute("style","position: absolute; left: -1000px; top: -1000px"),e.style.setAttribute&&e.style.setAttribute("cssText","position: absolute; left: -1000px; top: -1000px"),(t=document.getElementById("amazon-root"))||((t=document.createElement("div")).setAttribute("id","amazon-root"),document.body.appendChild(t)),t.appendChild(e)),e}function l(){this.a=[]}l.prototype.wait=function(t,e){this.a.push({ya:t,persist:!!e})},l.prototype.b=function(t){var e=this.a;this.a=[];for(var n=0;n<e.length;n++)e[n].persist&&this.a.push(e[n]);for(n=0;n<e.length;n++)e[n].ya.apply(void 0,arguments)};var h,m=function(){function t(){for(;a&&" ">=a;)o()}function e(){var t,e,n="";if('"'===a)for(;o();){if('"'===a)return o(),n;if("\\"===a)if(o(),"u"===a){for(t=e=0;4>t;t+=1){var i=parseInt(o(),16);if(!isFinite(i))break;e=16*e+i}n+=String.fromCharCode(e)}else{if("string"!=typeof c[a])break;n+=c[a]}else n+=a}r("Bad string")}function n(){var t="";for("-"===a&&(t="-",o("-"));"0"<=a&&"9">=a;)t+=a,o();if("."===a)for(t+=".";o()&&"0"<=a&&"9">=a;)t+=a;if("e"===a||"E"===a)for(t+=a,o(),"-"!==a&&"+"!==a||(t+=a,o());"0"<=a&&"9">=a;)t+=a,o();if(t=+t,isFinite(t))return t;r("Bad number")}function o(t){return t&&t!==a&&r("Expected '"+t+"' instead of '"+a+"'"),a=s.charAt(i),i+=1,a}function r(t){throw{name:"SyntaxError",message:t,Ka:i,text:s}}var i,a,s,c={'"':'"',"\\":"\\","/":"/",s:"\b",I:"\f",n:"\n",r:"\r",t:"\t"},u=function(){switch(t(),a){case"{":t:{var i={};if("{"===a){if(o("{"),t(),"}"===a){o("}");var s=i;break t}for(;a;){if(s=e(),t(),o(":"),Object.hasOwnProperty.call(i,s)&&r('Duplicate key "'+s+'"'),i[s]=u(),t(),"}"===a){o("}"),s=i;break t}o(","),t()}}r("Bad object"),s=void 0}return s;case"[":t:{if(s=[],"["===a){if(o("["),t(),"]"===a){o("]");break t}for(;a;){if(s.push(u()),t(),"]"===a){o("]");break t}o(","),t()}}r("Bad array"),s=void 0}return s;case'"':return e();case"-":return n();default:return"0"<=a&&"9">=a?n():function(){switch(a){case"t":return o("t"),o("r"),o("u"),o("e"),!0;case"f":return o("f"),o("a"),o("l"),o("s"),o("e"),!1;case"n":return o("n"),o("u"),o("l"),o("l"),null}r("Unexpected '"+a+"'")}()}};return function(e,n){return s=e,i=0,a=" ",e=u(),t(),a&&r("Syntax error"),"function"==typeof n?function t(e,o){var r,i=e[o];if(i&&"object"==typeof i)for(r in i)if(Object.prototype.hasOwnProperty.call(i,r)){var a=t(i,r);void 0!==a?i[r]=a:delete i[r]}return n.call(e,o,i)}({"":e},""):e}}(),g=function(){function t(t){return 10>t?"0"+t:t}function e(t){return a.lastIndex=0,a.test(t)?'"'+t.replace(a,function(t){var e=s[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function n(t,a){var s=o,c=a[t];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(t)),"function"==typeof i&&(c=i.call(a,t,c)),typeof c){case"string":return e(c);case"number":return isFinite(c)?String(c):"null";case"boolean":case"null":return String(c);case"object":if(!c)return"null";o+=r;var u=[];if("[object Array]"===Object.prototype.toString.apply(c)){var p=c.length;for(t=0;t<p;t+=1)u[t]=n(t,c)||"null";return a=0===u.length?"[]":o?"[\n"+o+u.join(",\n"+o)+"\n"+s+"]":"["+u.join(",")+"]",o=s,a}if(i&&"object"==typeof i){for(p=i.length,t=0;t<p;t+=1)if("string"==typeof i[t]){var f=i[t];(a=n(f,c))&&u.push(e(f)+(o?": ":":")+a)}}else for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&(a=n(f,c))&&u.push(e(f)+(o?": ":":")+a);return a=0===u.length?"{}":o?"{\n"+o+u.join(",\n"+o)+"\n"+s+"}":"{"+u.join(",")+"}",o=s,a}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var o,r,i,a=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return function(t,e,a){var s;if(r=o="","number"==typeof a)for(s=0;s<a;s+=1)r+=" ";else"string"==typeof a&&(r=a);if((i=e)&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw Error("JSON.stringify");return n("",{"":t})}}();function v(t){var e,n="";for(e in t)n&&(n+="&"),n+=encodeURIComponent(e)+"="+encodeURIComponent(t[e]+"");return n}function w(){return!!(window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest||void 0!==window.XDomainRequest)}function _(t,e,n,o,r,i){this.h=new S(t,e,n),"string"==typeof o&&o||c("missing or invalid path: %s",o),this.g=o,"object"==typeof r&&(r=v(r)),r&&"string"!=typeof r&&c("invalid query: %s",r),this.b=r||"","object"==typeof i&&(i=v(i)),i&&"string"!=typeof i&&c("invalid fragment: %s",i),this.a=i||""}function y(t){var e=function(){var e=document.createElement("div");return e.innerHTML="<a></a>",e.firstChild.href=t,e.innerHTML=e.innerHTML,e.firstChild}();return""==e.host&&(e.href=e.href),new _(e.protocol,e.hostname,function(){var t=e.port;return t&&"0"!=t||(t=null),t}(),function(){var t=e.pathname;return t?"/"!=t[0]&&(t="/"+t):t="/",t}(),e.search.substring(1),e.href.split("#")[1]||"")}function b(t){var e="http"==t.h.scheme();return t=t.h.host(),e&&("localhost"==t||"127.0.0.1"==t)}function k(t,e){return new _(void 0!==e.scheme?e.scheme:t.scheme(),void 0!==e.host?e.host:t.host(),void 0!==e.port?e.port:t.port(),void 0!==e.path?e.path:t.path(),void 0!==e.query?e.query:t.query(),void 0!==e.u?e.u:t.u())}function S(t,e,n){var o;"string"==typeof t&&(o=t.match(/^(https?)(:(\/\/)?)?$/i))||c("missing or invalid scheme: %s",t),this.a="http"==o[1]?"http":"https",(t="string"==typeof e&&e)&&("string"==typeof e&&e||c("missing or invalid input: %s",e),t=0!=e.replace(/^\s+|\s+$/g,"").length),t||c("missing or invalid host: %s",e),this.g=e,n&&((n+"").match(/^\d+$/)||c("invalid port: %s",n),80==n&&"http"==this.a||443==n&&"https"==this.a)&&(n=null),this.b=n?n+"":null}function z(t,e,n,o){return new _(t.a,t.g,t.b,e,n,o)}function A(t){for(var e="",n=0;n<t;n++)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e}!function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];""==o||t.b.hasOwnProperty(o)||(t.a.push(o),t.b[o]=1)}}(e=function(e){this.a=[],e="string"==typeof e?e.split(/\s+/):e,this.b={},t(this,e)}).prototype.contains=function(t){for(var e=0;e<t.a.length;e++)if(!this.b.hasOwnProperty(t.a[e]))return!1;return!0},e.prototype.add=function(e){t(this,e.a)},e.prototype.g=function(t){for(var e=0;e<this.a.length;e++)t(this.a[e])},e.prototype.toString=function(){return this.a.join(" ")}}(),h=null,(n={}).fa=function(){return h},n.j=function(t){f("domain",t,"string"),t=t.replace(/^\s+|\s+$/g,"");var e="."+window.location.hostname;"."!=t.charAt(0)&&(t="."+t),e.indexOf(t)!=e.length-t.length&&c("Site domain must contain the current page's domain"),h=t},n.R=function(){},n.R.prototype.getItem=function(){},n.R.setItem=function(){},n.R.removeItem=function(){},function(){function t(){}t.prototype.getItem=function(t){return null==(t=new RegExp("(?:^|;)\\s*"+escape(t).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*)(?:;|$)").exec(document.cookie))?null:unescape(t[1])},t.prototype.setItem=function(t,e,o){var r=null==o?"Fri, 31 Dec 9999 23:59:59 GMT":new Date((new Date).getTime()+1e3*o).toGMTString(),i=n.fa();i=null==i?"":";Domain="+i;var a=b(y(window.location.href))?"":";Secure";document.cookie=t+"="+escape(e)+("session"==o?"":";Expires="+r)+i+";Path=/"+a},t.prototype.removeItem=function(t){n.f.setItem(t,"null",0)},n.f=new t}(),function(){function t(t){this.a=t}t.prototype.getItem=function(t){return this.a.getItem(t)},t.prototype.setItem=function(t,e,n){this.a.setItem(t,e,n)},t.prototype.removeItem=function(t){n.f.removeItem(t)},n.C=new t(n.f)}(),o={za:function(t){var e=n.f.getItem("amazon_Login_auth_code_scope_cache");if(e)return(e=m(e))[t]},ua:function(t,e){var o={};o[t]=e,n.C.setItem("amazon_Login_auth_code_scope_cache",g(o),240)},va:function(t,e,o){"bearer"==t.token_type&&(t=g({access_token:t.access_token,max_age:o,expiration_date:(new Date).getTime()+1e3*o,client_id:r.ea(),scope:e}),n.C.setItem("amazon_Login_state_cache",t,"session"))},T:function(){var t=n.C.getItem("amazon_Login_state_cache");return null!=t&&(null!=(t=m(t))&&t.expiration_date>(new Date).getTime())?(t.scope=new e(t.scope),t):null},S:function(){n.C.removeItem("amazon_Login_state_cache")}},(t=_.prototype).scheme=function(){return this.h.scheme()},t.host=function(){return this.h.host()},t.port=function(){return this.h.port()},t.path=function(){return this.g},t.query=function(){return this.b},t.u=function(){return this.a},t.toString=function(){var t=this.h.toString();return t+=this.g,(t+=this.b?"?"+this.b:"")+(this.a?"#"+this.a:"")},S.prototype.scheme=function(){return this.a},S.prototype.host=function(){return this.g},S.prototype.port=function(){return this.b},S.prototype.toString=function(){var t=this.a+"://";return(t+=this.g)+(this.b?":"+this.b:"")};var C={},x=null;function I(t,e){var n=function(t){return x||(x=function(){var t=window.postMessage?"pm":"fr";if(window.__toucanForceTransport&&(t=window.__toucanForceTransport),"pm"==t)t=new q;else{if("fr"!=t)throw c("unknown transport: %s",t),Error();t=new M}return t}()).ja(t,function(t,e){(t=C[t])&&t.b(e)}),x}(t),o=t.host().replace(/[^a-z0-9]/gi,"_");t.port()&&(o+="_"+t.port()),o=u("amazon-proxy-%s-%s",t.scheme(),o);var r=document.getElementById(o);return r||((r=document.createElement("iframe")).setAttribute("id",o),r.setAttribute("name",o),r.setAttribute("src",function(t,e){return e={uri:E().toString(),tr:e.name()},z(t,"/ap/oa/proxy.html",{version:"3",build:"2021-04-26-p3vs6bcj"},e)}(t,n).toString()),d("amazon-proxy-root").appendChild(r)),n=A(16),C[n]||(C[n]=new l),C[n].wait(e,!1),z(t,"/sdk/2021-04-26-p3vs6bcj/topic.html",e={uri:E().toString(),proxy:o,topic:n,version:"3"},"")}function E(){return k(y(window.location.href),{query:"",u:""})}var L=/^ABMNZNXDC;([\w\d_\-]+);(.*)$/;function T(t){if("string"==typeof t){var e=t.match(L);if(e){(t={}).id=e[1];var n={};e=e[2].split("&");for(var o=0;o<e.length;o++){var r=e[o].split("=");2==r.length&&(n[r[0]]=decodeURIComponent(r[1].replace(/\+/g," ")))}return t.data=n,t}}return null}function q(){this.a=void 0}function M(){}q.prototype.name=function(){return"pm"},q.prototype.ja=function(t,e){!function(t){if(void 0===t.a){var e=t.a=new l;t=function(t){var n;(n=T(t.data))&&e.b(t.origin,n.id,n.data)},window.addEventListener?window.addEventListener("message",t,!1):window.attachEvent?window.attachEvent("onmessage",t):c("cannot attach message event")}}(this);var n=t.toString();this.a.wait(function(t,o,r){var i=y(window.location.href).h.toString();t!=n&&t!=i||e(o,r)},!0)},q.prototype.send=function(t,e,n){var o=t.h,r=m(g(n));setTimeout(function(){window.parent.postMessage(u("%s;%s;%s","ABMNZNXDC",e,v(r)),o.toString())},1)},M.prototype.name=function(){return"fr"},M.prototype.ja=function(t,e){window.__toucanInvokeFragment=function(t,n){e(t,n)}},M.prototype.send=function(t,e,n){var o=t.query();(o=o||"")&&(o+="&"),t=k(t,{query:o=o+"ABMNZNXDC="+A(8),u:u("%s;%s;%s","ABMNZNXDC",e,v(n))}),(e=document.createElement("iframe")).setAttribute("src",t.toString()),document.body.appendChild(e)};var O=window.location.href.split("#")[1]||"";if(O){var R=T(O);R&&(document.documentElement.style.display="none","function"==typeof window.parent.parent.__toucanInvokeFragment&&window.parent.parent.__toucanInvokeFragment(R.id,R.data))}function N(t,e,n){t["payments:widget"]={redirectUrl:n.h.toString(),originUrl:window.location.origin,isSandbox:e||!1}}!function(){function t(t){var e=t.match(R);e||c("invalid domain: %s",t);var n=e[2]?e[2].toLowerCase():"https";return"https"!=n&&c("invalid domain: %s; scheme must be https",t),(t=e[3]).match(/^amazon\.[a-z\.]+$/)&&(t="www."+t),new S(n,t,e[5])}function a(t){f("options.response_type",(t=s({interactive:void 0,popup:!0,response_type:"token",response_mode:void 0,delegated_requests:void 0,direct_post_uri:void 0,state:void 0,scope:void 0,scope_data:void 0,optional_scope:void 0,"com.amazon.oauth2.options":void 0,workflow_data:void 0,pkce:!1,code_challenge:void 0,code_challenge_method:"S256"},t||{})).response_type,"string"),t.response_mode&&f("options.response_mode",t.response_mode,"string"),t.direct_post_uri&&f("options.direct_post_uri",t.direct_post_uri,"string"),!0===t[M.ra]&&t[M.P]===M.Z&&t.interactive!==U.NEVER&&!0!==t[M.v]&&w()&&(t[M.v]=!0,t[M.O]=!0),(!0===t[M.v]||t[M.l])&&(t[M.P]="code");var n=t.delegated_requests;if(n){!function(t){t&&"delegate"===t||c("expected %s value to be %s but was %s","options.response_type","delegate",t)}(t.response_type),t.scope&&c("options.scope is not supported for delegated authorization"),t.scope_data&&c("options.scope_data is not supported for delegated authorization"),t.optional_scope&&c("options.optional_scope is not supported for delegated authorization"),t.interactive?t.interactive!=U.ALWAYS&&c("options.interactive should be '"+U.ALWAYS+"' for delegated authorization"):t.interactive=U.ALWAYS;for(var o={},r=0;r<n.length;r++){var i=n[r],a=p(t,i);o[i.request_id]=a}t.delegated_requests=o}else if(l(t,"missing options.scope"),h(t),m(t),t.interactive?t.interactive!=U.M&&t.interactive!=U.ALWAYS&&t.interactive!=U.NEVER&&c("expected options.interactive to be one of '"+U.M+"', '"+U.ALWAYS+"', or '"+U.NEVER+"'"):t.interactive=U.M,t.optional_scope){t.optional_scope.constructor!==Array&&"string"!=typeof t.optional_scope&&c("expected options.optional_scope to be a string or array"),t.interactive!=U.NEVER&&c("options.optional_scope is only supported for options.interactive = never"),n=new e(t.optional_scope),t.scope.add(n);var u={id_token:{}};n.g(function(t){u.id_token[t]={essential:!1}}),t.optional_scope=g(u)}return t}function p(t,e){for(var n in e.response_mode&&c("response_mode is not supported in delegated requests"),e.direct_post_uri&&c("direct_post_uri is not supported in delegated requests"),"popup"in e&&c("popup is not supported in delegated requests"),e.interactive&&c("interactive mode is not supported in delegated requests"),e.optional_scope&&c("optional_scope is not supported in delegated requests"),e.delegated_requests&&c("delegated_requests is not supported in delegated requests"),null==e.response_type&&(e.response_type="token"),l(e,"missing 'scope' in delegated request"),e.scope=e.scope.toString(),h(e),m(t),f("request_id",e.request_id,"string"),e.client_id&&!e.client_id.match(O)&&c("invalid client_id format: %s",e.client_id),t={},e)"request_id"!=n&&(t[n]=e[n]);return t}function l(t,n){t.scope||c(n),t.scope.constructor!==Array&&"string"!=typeof t.scope&&c("expected scope to be a string or array"),t.scope=new e(t.scope)}function h(t){t.scope_data&&(t.scope_data=g(t.scope_data))}function m(t){if(t.workflow_data){var e={};e.workflow_data=t.workflow_data,t["com.amazon.oauth2.options"]=g(e)}}function _(){null!=j&&("function"==typeof j.close&&j.close(),j=null)}function C(t,e,n){var o={client_id:H,redirect_uri:e,response_type:t.response_type,language:Y,ui_locales:V};if(t["com.amazon.oauth2.options"]&&(o["com.amazon.oauth2.options"]=t["com.amazon.oauth2.options"]),t.response_mode&&(o.response_mode=t.response_mode),t.scope&&(o.scope=t.scope.toString()),t.direct_post_uri&&(o.direct_post_uri=t.direct_post_uri),t.scope_data&&(o.scope_data=t.scope_data),W&&(o.sandbox=!0),t.state&&(o.state=t.state),n&&(o.exac=n),t.delegated_requests&&(o.delegated_requests=g(t.delegated_requests)),(n=o.scope)&&-1!==n.indexOf("payments:widget")){n=o.sandbox;var r=o.scope_data;try{var a=r&&""!==r?JSON.parse(r):{}}catch(t){a={}}N(a,n,e),-1===JSON.stringify(a).indexOf("payments:widget")&&N(a={},n,e),e=JSON.stringify(a),o.scope_data=e}if(t[M.l]&&(o[M.l]=t[M.l],o[M.N]=t[M.N]),!0!==t[M.v]||t[M.l]||(o[M.l]=i.Aa(o.client_id,o.redirect_uri),o[M.N]="S256"),8196<(t=z(J,"/ap/oa",o)).toString().length)throw console.error("URI has exceeded url length limit of 8196. Current Length of the URI: "+t.toString().length),400;return t}function x(t,e,i){for(D=!1,e.access_token?r.aa(e,e.scope):i&&n.f.removeItem(r.m),e.code&&!0===t.a[M.v]&&o.ua(e.code,e.scope),t.na(e),t=P,P=[],e=0;e<t.length;e++)T(t[e])}function E(t,e,n,o){var r=v(t);!n&&o?t=k(t=y(e),{u:r}):(e+=-1==e.indexOf("?")?"?":"&",t=y(e+=r)),r=y(window.location.href),"https"==t.scheme()||b(t)||c("attempted redirect to %s but scheme is not HTTPS",e),t.host()!=r.host()&&c("attempted redirect to %s but it does not match current host %s",t.host(),r.host()),!n&&o?window.top.location.href=t.toString():(_(),window.location.href=e)}function L(t){var e=this;this.a=t,this.g=null,this.W=[],this.V=null,this.b={status:null,onComplete:function(t){"string"!=typeof t&&"function"!=typeof t&&c("onComplete expects handler parameter to be a function or a string");var n=e.b.status==B.Y;return"string"==typeof t?n?E(e.V,t,e.a.popup,"token"==e.a.response_type):e.g=t:"function"==typeof t&&(n?setTimeout(function(){t(e.b)},0):e.W.push(t)),e.b}}}function T(t){var e=t.a,i=null;if(e.delegated_requests)q(t,null);else{if(e.interactive==U.ALWAYS)o.S();else{var a=null;if(r.ma()&&(a=n.f.getItem(r.m)),(i=o.T())&&("token"==e.response_type&&e.scope.add(i.scope),a?a!=i.access_token&&(o.S(),i=null):a=i.access_token),i&&i.scope.contains(e.scope)&&(e[M.P]===M.Z||!0===e[M.O])){var s={access_token:i.access_token,token_type:"bearer",expires_in:Math.floor((i.expiration_date-(new Date).getTime())/1e3),scope:i.scope.toString()};null!=e.state&&(s.state=e.state)}else if(e.interactive==U.NEVER&&e.popup){if(D)return P.push(t),void t.X(B.sa);if(a)return void function(t,e){D=!0;var n=d("amazon-client-credentials-root"),o=function(){var t=d("amazon-client-credentials-root"),e=A(16),n=document.createElement("iframe");return n.setAttribute("name",e),t.appendChild(n),0==document.getElementsByName(e).length&&(t.removeChild(n),n=document.createElement('<iframe name="'+e+'"/>'),t.appendChild(n)),n.setAttribute("id",e),e}(),r=document.createElement("form");n.appendChild(r),r.setAttribute("method","POST"),r.setAttribute("target",o);var i=I(J,function(e){n.removeChild(r);var i=document.getElementById(o);null!=i&&null!=i.parentNode&&i.parentNode.removeChild(i),null==e&&(e={error:"server_error",description:"Server error."}),x(t,e,!1)}),a=t.a;e={client_id:H,exac:e,grant_type:"client_credentials",redirect_uri:i,response_type:a.response_type,scope:a.scope},null!=a.state&&(e.state=a.state),null!=a.response_mode&&(e.response_mode=a.response_mode),null!=a.direct_post_uri&&(e.direct_post_uri=a.direct_post_uri),null!=a.scope_data&&(e.scope_data=a.scope_data),null!=a.optional_scope&&(e.claims=a.optional_scope),null!=a["com.amazon.oauth2.options"]&&(e["com.amazon.oauth2.options"]=a["com.amazon.oauth2.options"]),r.setAttribute("action",z(J,"/ap/oa",e).toString()),r.submit()}(t,a);s={error:"invalid_grant",error_description:"invalid grant"}}if(s)return void setTimeout(function(){t.na(s)},0)}q(t,a)}}function q(t,e){var n=t.a;if(n.popup){D=!0;var o=I(J,function(e){_(),e.code&&!0===n[M.O]?i.la(e.code,function(n){!0===n.success&&(n.scope=e.scope),n.success=null,x(t,n,!0)}):x(t,e,!0)});(function(t){var e=(void 0!==window.screenX?window.screenX:window.screenLeft)+Math.floor(((void 0!==window.outerWidth?window.outerWidth:document.documentElement.clientWidth)-800)/2),n=(void 0!==window.screenY?window.screenY:window.screenTop)+Math.floor(((void 0!==window.outerHeight?window.outerHeight:document.documentElement.clientHeight)-540)/2);e=u("left=%s,top=%s,width=%s,height=%s,scrollbars=1",0>e?0:e,0>n?0:n,800,540),j=window.open(t.toString(),"amazonloginpopup",e)})(e=C(t.a,o,e))}else(o=t.g)||c("Missing redirectUrl for redirect flow"),window.top.location.href=C(n,y(o+""),e).toString()}var M=(r={F:{NorthAmerica:"NA",Europe:"EU",AsiaPacific:"APAC",China:"CN"},pa:{v:"pkce",N:"code_challenge_method",l:"code_challenge",P:"response_type",O:"convert_implicit_to_pkce",ra:"popup",Z:"token"},m:"amazon_Login_accessToken"}).pa,O=/^[\w\-\.]+$/,R=/^((http|https):\/\/)?([a-z0-9\-\.]+)(:(\d+))?\/?$/i,U={ALWAYS:"always",M:"auto",NEVER:"never"},j=null,D=!1,P=[],B={sa:"queued",oa:"in_progress",Y:"complete"},H=void 0;r.ea=function(){return H},r.Da=function(t){t.match(O)||c("invalid client ID: %s",t),H=t};var X="na.account.amazon.com",J=new S("https",X,null),F=new S("https","api.amazon.com",null);r.fa=function(){return X},r.da=function(){return F};var W=!1;r.Ha=function(t){"number"==typeof t&&(t=!!t),f("sandboxMode",t,"boolean"),W=t},r.j=function(e){J=t(e),X=e},r.B=function(e){F=t(e)},r.Ga=function(t){t&&(t===r.F.Europe?(r.j("https://eu.account.amazon.com"),r.B("https://api.amazon.co.uk")):t===r.F.AsiaPacific?(r.j("https://apac.account.amazon.com"),r.B("https://api.amazon.co.jp")):t===r.F.China?(r.j("https://www.amazon.cn"),r.B("https://api.amazon.cn")):(r.j("https://na.account.amazon.com"),r.B("https://api.amazon.com")))};var Y="";r.Ea=function(t){Y=t};var V="";r.Fa=function(t){V=t},r.Ba=function(){return J};var G=!1;r.ma=function(){return G},r.Ia=function(t){null==t?c("missing useCookie"):"number"==typeof t?t=!!t:"boolean"!=typeof t&&c("expected useCookie to be a boolean"),G=t},r.aa=function(t,e){var i=parseInt(t.expires_in,10);i=60>=i?i:i-Math.min(Math.floor(.1*i),300),o.va(t,e,i),r.ma()?n.f.setItem(r.m,t.access_token,i):n.f.removeItem(r.m)},L.prototype.na=function(t){for(this.V=t,s(this.b,t),this.X(B.Y),t=0;t<this.W.length;t++)this.W[t](this.b);null!=this.g&&E(this.V,this.g,this.a.popup,"token"==this.a.response_type)},L.prototype.X=function(t){this.b.status=t},r.$=function(t,e){2>arguments.length&&c("authorize expects two arguments (options, next)"),t&&"object"!=typeof t&&c("authorize expects options parameter to be an object"),null!=e&&"function"!=typeof e&&"string"!=typeof e&&c("authorize expects next parameter to be a function or a string");var n=new L(t=a(t)),o=n.b;return n.X(B.oa),null!=e&&o.onComplete(e),t.popup||"string"==typeof e?T(n):c("next must be redirect URI if !options.popup"),o}}(),function(){function t(t,e){try{var n=m(t)}catch(t){n=null}n&&n.Error?((t={success:!1}).error=u("%s: %s",n.Error.Code||"UnknownError",n.Error.Message||"An unknown error occurred"),e(t)):n&&n.Profile?((t={success:!0}).profile=n.Profile,e(t)):e(t={success:!1,error:"UnknownError: Incomprehensible response from profile endpoint"})}a={ka:function(e,n){if(null==n&&"function"==typeof e)n=e,r.$({scope:"profile"},function(t){null==t.error?a.ka(t.access_token,n):n({success:!1,error:t.error})});else if(f("accessToken",e,"string"),f("callback",n,"function"),w()){if(e=z(r.Ba(),"/ap/user/profile",{access_token:e},"").toString(),window.XDomainRequest){var o=new window.XDomainRequest;o.onload=function(){t(o.responseText,n)}}else{var i=!1;(o=new window.XMLHttpRequest).onreadystatechange=function(){i||4!=o.readyState||(i=!0,t(o.responseText,n))}}o.open("GET",e,!0),o.send()}else n({success:!1,error:"UnsupportedOperation: Cannot retrieve profile in this browser"})}}}(),function(){function t(t,e,a){try{var s=m(t);n.f.removeItem(i.D)}catch(t){s=null}t={},s&&s.Error?(t.success=!1,t.error=u("%s: %s",s.Error.Code||"UnknownError",s.Error.Message||"An unknown error occurred")):s&&s.access_token?(t.success=!0,t.access_token=s.access_token,t.token_type=s.token_type,t.expires_in=s.expires_in,(e=o.za(e))&&r.aa(s,e)):(t.success=!1,t.error="UnknownError: Incomprehensible response from token endpoint"),a(t)}function e(){var t=n.f.getItem(i.D);return t?m(t):null}i={D:"amazon_Login_pkce_params",qa:240,Aa:function(t,o){var r,a=e();if(a&&(a.client_id!=t?n.f.removeItem(i.D):a.code_verifier&&(r=a.code_verifier)),!r){for(r="",a=128;0<a;--a)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];r=encodeURIComponent(r)}return t={client_id:t,code_verifier:r,redirect_uri:encodeURIComponent(o)},n.f.setItem(i.D,g(t),i.qa),t=U.hash.K.hash(r),U.i.ta.J(t)},la:function(n,i){if(null==n&&null==i)return function(){var t=o.T();return t?{success:!0,access_token:t.access_token,token_type:"bearer",expires_in:Math.floor((t.expiration_date-(new Date).getTime())/1e3),scope:t.scope.toString()}:null}();f("code",n,"string"),f("callback",i,"function");var a={};if(w()){var s=e();if(s){a=function(t,e){return t={grant_type:"authorization_code",client_id:t.client_id,redirect_uri:decodeURIComponent(t.redirect_uri),code_verifier:t.code_verifier,code:e},g(t)}(s,n);var c=!1;if(window.XDomainRequest){var u=new window.XDomainRequest;u.onload=function(){t(u.responseText,n,i)}}else(u=new window.XMLHttpRequest).onreadystatechange=function(){c||4!=u.readyState||(c=!0,t(u.responseText,n,i))};u.open("POST",r.da()+"/auth/O2/token",!0),"function"==typeof u.setRequestHeader&&u.setRequestHeader("Content-Type","application/json"),u.send(a)}else a.success=!1,a.error="UnsupportedOperation: Cookie amazon_Login_pkce_params not found. Cannot retrieve token without cookie.",i(a)}else a.success=!1,a.error="UnsupportedOperation: Cannot retrieve token in this browser",i(a)}}}(),function(){function t(t,n){w()||i("UnsupportedOperation: Cannot remotely logout in this browser",n);var o=z(r.da(),"/auth/relyingPartyLogout",null,null).toString(),a={};if(a.token=t,a.token_type="bearer",window.XDomainRequest){var s=new window.XDomainRequest;s.onload=function(){e(s.responseText,n)}}else{var c=!1;(s=new window.XMLHttpRequest).onreadystatechange=function(){c||4!=s.readyState||(c=!0,e(s.responseText,n))}}s.open("POST",o,!0),s.send(g(a))}function e(t,e){try{var n=m(t).response}catch(t){n=void 0}if(!n||n.error){t="UnknownError";var o="An unknown error ocurred";n&&n.error&&n.error.code&&n.error.message&&(t=n.error.code,o=n.error.message),o=u("%s: %s",t,o)}i(o,e)}function i(t,e){t&&p("logout",t),e&&"function"==typeof e&&e()}r.Ca=function(){var e=n.f.getItem(r.m),i=o.T();e&&n.f.removeItem(r.m),!e&&i&&(e=i.access_token),o.S(),e&&t(e,void 0)}}(),window.amazon=window.amazon||{},window.amazon.Login=window.amazon.Login||{},window.amazon.Login.getClientId=function(){return r.ea()},window.amazon.Login.setClientId=function(t){return r.Da(t)},window.amazon.Login.setDomain=function(t){return r.j(t)},window.amazon.Login.setAPIDomain=function(t){return r.B(t)},window.amazon.Login.setSandboxMode=function(t){return r.Ha(t)},window.amazon.Login.setSiteDomain=function(t){return n.j(t)},window.amazon.Login.Region=r.F,window.amazon.Login.setRegion=function(t){return r.Ga(t)},window.amazon.Login.setLanguage=function(t){return r.Ea(t)},window.amazon.Login.setLanguageHint=function(t){return r.Fa(t)},window.amazon.Login.setUseCookie=function(t){return r.Ia(t)},window.amazon.Login.authorize=function(t,e){return r.$(t,e)},window.amazon.Login.logout=function(){return r.Ca()},window.amazon.Login.retrieveProfile=function(t,e){return a.ka(t,e)},window.amazon.Login.retrieveToken=function(t,e){return i.la(t,e)},"function"==typeof window.onAmazonLoginReady&&window.onAmazonLoginReady();var U={Oa:{},hash:{},Ta:{},mode:{},Ua:{},i:{},ba:{Pa:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},ia:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},Ma:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},Va:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}},c:{La:function(t,e,n){return t=U.c.ha(t.slice(e/32),32-(31&e)).slice(1),void 0===n?t:U.c.wa(t,n-e)},Ra:function(t,e,n){var o=Math.floor(-e-n&31);return(-32&(e+n-1^e)?t[e/32|0]<<32-o^t[e/32+1|0]>>>o:t[e/32|0]>>>o)&(1<<n)-1},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var n=t[t.length-1],o=U.c.U(n);return 32===o?t.concat(e):U.c.ha(e,o,0|n,t.slice(0,t.length-1))},w:function(t){var e=t.length;return 0===e?0:32*(e-1)+U.c.U(t[e-1])},wa:function(t,e){if(32*t.length<e)return t;var n=(t=t.slice(0,Math.ceil(e/32))).length;return e&=31,0<n&&e&&(t[n-1]=U.c.A(e,t[n-1]&2147483648>>e-1,1)),t},A:function(t,e,n){return 32===t?e:(n?0|e:e<<32-t)+1099511627776*t},U:function(t){return Math.round(t/1099511627776)||32},Qa:function(t,e){if(U.c.w(t)!==U.c.w(e))return!1;var n,o=0;for(n=0;n<t.length;n++)o|=t[n]^e[n];return 0===o},ha:function(t,e,n,o){var r;for(void 0===o&&(o=[]);32<=e;e-=32)o.push(n),n=0;if(0===e)return o.concat(t);for(r=0;r<t.length;r++)o.push(n|t[r]>>>e),n=t[r]<<32-e;return r=t.length?t[t.length-1]:0,t=U.c.U(r),o.push(U.c.A(e+t&31,32<e+t?n:o.pop(),1)),o},Sa:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]},Na:function(t){var e;for(e=0;e<t.length;++e){var n=t[e];t[e]=n>>>24|n>>>8&65280|(65280&n)<<8|n<<24}return t}}};function j(t,e){var n,o,r=t.H,i=t.I,a=r[0],s=r[1],c=r[2],u=r[3],p=r[4],f=r[5],d=r[6],l=r[7];for(t=0;64>t;t++)16>t?n=e[t]:(n=e[t+1&15],o=e[t+14&15],n=e[15&t]=(n>>>7^n>>>18^n>>>3^n<<25^n<<14)+(o>>>17^o>>>19^o>>>10^o<<15^o<<13)+e[15&t]+e[t+9&15]|0),n=n+l+(p>>>6^p>>>11^p>>>25^p<<26^p<<21^p<<7)+(d^p&(f^d))+i[t],l=d,d=f,f=p,p=u+n|0,u=c,c=s,a=n+((s=a)&c^u&(s^c))+(s>>>2^s>>>13^s>>>22^s<<30^s<<19^s<<10)|0;r[0]=r[0]+a|0,r[1]=r[1]+s|0,r[2]=r[2]+c|0,r[3]=r[3]+u|0,r[4]=r[4]+p|0,r[5]=r[5]+f|0,r[6]=r[6]+d|0,r[7]=r[7]+l|0}U.i.Ja={J:function(t){var e,n,o="",r=U.c.w(t);for(e=0;e<r/8;e++)0==(3&e)&&(n=t[e/4]),o+=String.fromCharCode(n>>>8>>>8>>>8),n<<=8;return decodeURIComponent(escape(o))},L:function(t){t=unescape(encodeURIComponent(t));var e,n=[],o=0;for(e=0;e<t.length;e++)o=o<<8|t.charCodeAt(e),3==(3&e)&&(n.push(o),o=0);return 3&e&&n.push(U.c.A(8*(3&e),o)),n}},U.i.G={ca:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",J:function(t,e,n){var o="",r=0,i=U.i.G.ca,a=0,s=U.c.w(t);for(n&&(i=i.substr(0,62)+"-_"),n=0;6*o.length<s;)o+=i.charAt((a^t[n]>>>r)>>>26),6>r?(a=t[n]<<6-r,r+=26,n++):(a<<=6,r-=6);for(;3&o.length&&!e;)o+="=";return o},L:function(t,e){t=t.replace(/\s|=/g,"");var n=[],o=0,r=U.i.G.ca,i=0;for(e&&(r=r.substr(0,62)+"-_"),e=0;e<t.length;e++){var a=r.indexOf(t.charAt(e));if(0>a)throw new U.ba.ia("this isn't base64!");26<o?(o-=26,n.push(i^a>>>o),i=a<<32-o):i^=a<<32-(o+=6)}return 56&o&&n.push(U.c.A(56&o,i,1)),n}},U.i.ta={J:function(t){return U.i.G.J(t,1,1)},L:function(t){return U.i.G.L(t,1)}},U.hash.K=function(t){this.I[0]||function(t){function e(t){return 4294967296*(t-Math.floor(t))|0}for(var n,o,r=0,i=2;64>r;i++){for(o=!0,n=2;n*n<=i;n++)if(0==i%n){o=!1;break}o&&(8>r&&(t.ga[r]=e(Math.pow(i,.5))),t.I[r]=e(Math.pow(i,1/3)),r++)}}(this),t?(this.H=t.H.slice(0),this.s=t.s.slice(0),this.o=t.o):this.reset()},U.hash.K.hash=function(t){var e,n=(t=(new U.hash.K).update(t)).s,o=t.H;for(e=(n=U.c.concat(n,[U.c.A(1,1)])).length+2;15&e;e++)n.push(0);for(n.push(Math.floor(t.o/4294967296)),n.push(0|t.o);n.length;)j(t,n.splice(0,16));return t.reset(),o},U.hash.K.prototype={reset:function(){return this.H=this.ga.slice(0),this.s=[],this.o=0,this},update:function(t){"string"==typeof t&&(t=U.i.Ja.L(t));var e=this.s=U.c.concat(this.s,t),n=this.o;if(9007199254740991<(t=this.o=n+U.c.w(t)))throw new U.ba.ia("Cannot hash more than 2^53 - 1 bits");if("undefined"!=typeof Uint32Array){var o=new Uint32Array(e),r=0;for(n=512+n-(512+n&511);n<=t;n+=512)j(this,o.subarray(16*r,16*(r+1))),r+=1;e.splice(0,16*r)}else for(n=512+n-(512+n&511);n<=t;n+=512)j(this,e.splice(0,16));return this},ga:[],I:[]},"undefined"!=typeof module&&module.xa&&(module.xa=U),"function"==typeof define&&define([],function(){return U})}();
      amazon.Login.setClientId('amzn1.application-oa2-client.c93b19e2f3fc4c6ba74a7714a7391aa6');

      let options = { } ;
      options.scope = 'profile';
      options.response_type='code';
      amazon.Login.authorize(options, function(response) {
        if ( response.error ) {
          alert('oauth error ' + response.error);
        }
        fetch('/amazonLogin',{
          method: 'POST',
          headers:{
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            code: response.code
          }),
        }).then(res=>res.json()).then(res=>{
          if(res.result === 'OK'){
            localStorage.setItem('username', res.userID);
            store.commit("login", res.userID);
            router.push('/')
          }
        })
      });
    },
    submit: function () {
      this.error = "";
      let inputs = document.getElementsByTagName("input");
      for (let item of inputs) {
        if(item.value === "") {
          this.error="Please fill all Fields"
          return;
        }
      }
      let complication = "";
      let username = "";
      fetch('/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body:JSON.stringify({
          username: this.username,
          password: this.password
        }),
        mode: "cors"
      }).then(result => {
        result.headers.forEach(header => {
          if(header === "ERROR") {this.error = "Wrong Credentials"} //this.$t('error')
          else if(header === "WARNING") {this.error = "Please confirm your E-Mail"}
        })
        let reader = result.body.getReader();
        reader.read().then(function processText({ done, value }) {
          if (done) return;
          let string = new TextDecoder().decode(value);
          let data = JSON.parse(string)
          if(data.result === "WARNING" || data.result === "ERROR") {
            complication = data.message
          } else if(data.result === "OK") {
            username = data.username;
            console.log(data)
            localStorage.setItem('username', data.username);
            return reader.read().then(processText);
          }
        }).then(() => {
          if(complication === "") {
            console.log("Login2")
            this.$store.commit("login", username);
            this.$router.push({name: "Home"});
          } else {
            this.error = complication
          }
        })
      })
      .catch((error) => {
        console.error('Error:', error);
      });
    }
  },

  computed: {
    username: function () {
      return this.$store.state.username
    }
  }

}
</script>

<style scoped lang="scss">
  h1, h3{
    font-family: 'Montserrat', sans-serif;
    color: var(--text-color)
  }


  .error {
    color: red;
  }

  .form {
    display: flex;
    flex-direction: column;

    button {
      cursor: pointer;
      text-decoration: none;
      outline: none;
      border: none;
      font-family: 'Montserrat', sans-serif;
      font-weight: 700;
      font-size: 1.5em;
      color: var(--background-color);
      background-color: var(--text-color);
      border-radius: 50px;
      padding: 0.3em 1.5em;

      &:hover {
         color: var(--text-color);
         background-color: var(--background-color);
         border: 1px solid var(--text-color);
       }
    }

    input {
      outline: none;
      color: var(--text-color);
      font-weight: 500;
      font-family: 'Montserrat', sans-serif;
      font-size: 1.5em;
      margin: 0.5em 0;
      padding: 0.1em 1em;
      border-radius: 50px;
      background-color: var(--background-color);
      border: 1px solid var(--text-color);
    }
  }
</style>